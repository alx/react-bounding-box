/*! For license information please see react-bounding-box.js.LICENSE.txt */
!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],e):"object"==typeof exports?exports.Boundingbox=e(require("react"),require("prop-types")):t.Boundingbox=e(t.React,t.PropTypes)}(this,(t,e)=>(()=>{var n={20:(t,e,n)=>{"use strict";var o=n(442),i=Symbol.for("react.element"),s=(Symbol.for("react.fragment"),Object.prototype.hasOwnProperty),a=o.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,r={key:!0,ref:!0,__self:!0,__source:!0};function h(t,e,n){var o,h={},c=null,d=null;for(o in void 0!==n&&(c=""+n),void 0!==e.key&&(c=""+e.key),void 0!==e.ref&&(d=e.ref),e)s.call(e,o)&&!r.hasOwnProperty(o)&&(h[o]=e[o]);if(t&&t.defaultProps)for(o in e=t.defaultProps)void 0===h[o]&&(h[o]=e[o]);return{$$typeof:i,type:t,key:c,ref:d,props:h,_owner:a.current}}e.jsx=h,e.jsxs=h},31:function(t,e,n){var o;!function(t,i){function s(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var o=0;o<n.length+64;o++)e.x^=0|n.charCodeAt(o),o==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function r(t,e){var n=new s(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&a(o,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=r:n.amdD&&n.amdO?void 0===(o=function(){return r}.call(e,n,e,i))||(i.exports=o):this.xorwow=r}(0,t=n.nmd(t),n.amdD)},67:function(t,e,n){var o;!function(t,i){function s(t){var e=this;e.next=function(){var t,n,o=e.x,i=e.i;return t=o[i],n=(t^=t>>>7)^t<<24,n^=(t=o[i+1&7])^t>>>10,n^=(t=o[i+3&7])^t>>>3,n^=(t=o[i+4&7])^t<<7,t=o[i+7&7],n^=(t^=t<<13)^t<<9,o[i]=n,e.i=i+1&7,n},function(t,e){var n,o=[];if(e===(0|e))o[0]=e;else for(e=""+e,n=0;n<e.length;++n)o[7&n]=o[7&n]<<15^e.charCodeAt(n)+o[n+1&7]<<13;for(;o.length<8;)o.push(0);for(n=0;n<8&&0===o[n];++n);for(8==n?o[7]=-1:o[n],t.x=o,t.i=0,n=256;n>0;--n)t.next()}(e,t)}function a(t,e){return e.x=t.x.slice(),e.i=t.i,e}function r(t,e){null==t&&(t=+new Date);var n=new s(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.x&&a(o,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=r:n.amdD&&n.amdO?void 0===(o=function(){return r}.call(e,n,e,i))||(i.exports=o):this.xorshift7=r}(0,t=n.nmd(t),n.amdD)},180:function(t,e,n){var o;!function(t,i){function s(t){var e,n=this,o=(e=4022871197,function(t){t=t.toString();for(var n=0;n<t.length;n++){var o=.02519603282416938*(e+=t.charCodeAt(n));o-=e=o>>>0,e=(o*=e)>>>0,e+=4294967296*(o-=e)}return 2.3283064365386963e-10*(e>>>0)});n.next=function(){var t=2091639*n.s0+2.3283064365386963e-10*n.c;return n.s0=n.s1,n.s1=n.s2,n.s2=t-(n.c=0|t)},n.c=1,n.s0=o(" "),n.s1=o(" "),n.s2=o(" "),n.s0-=o(t),n.s0<0&&(n.s0+=1),n.s1-=o(t),n.s1<0&&(n.s1+=1),n.s2-=o(t),n.s2<0&&(n.s2+=1),o=null}function a(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function r(t,e){var n=new s(t),o=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,o&&("object"==typeof o&&a(o,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=r:n.amdD&&n.amdO?void 0===(o=function(){return r}.call(e,n,e,i))||(i.exports=o):this.alea=r}(0,t=n.nmd(t),n.amdD)},181:function(t,e,n){var o;!function(t,i){function s(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var o=0;o<n.length+64;o++)e.x^=0|n.charCodeAt(o),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function r(t,e){var n=new s(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&a(o,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=r:n.amdD&&n.amdO?void 0===(o=function(){return r}.call(e,n,e,i))||(i.exports=o):this.xor128=r}(0,t=n.nmd(t),n.amdD)},234:()=>{},391:(t,e,n)=>{var o=n(180),i=n(181),s=n(31),a=n(67),r=n(833),h=n(717),c=n(801);c.alea=o,c.xor128=i,c.xorwow=s,c.xorshift7=a,c.xor4096=r,c.tychei=h,t.exports=c},442:e=>{"use strict";e.exports=t},717:function(t,e,n){var o;!function(t,i){function s(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,o=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-o|0,o=o<<24^o>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-o|0,e.d=o<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var o=0;o<n.length+20;o++)e.b^=0|n.charCodeAt(o),e.next()}function a(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function r(t,e){var n=new s(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&("object"==typeof o&&a(o,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=r:n.amdD&&n.amdO?void 0===(o=function(){return r}.call(e,n,e,i))||(i.exports=o):this.tychei=r}(0,t=n.nmd(t),n.amdD)},801:(t,e,n)=>{var o;!function(i,s){var a,r=(0,eval)("this"),h=256,c="random",d=s.pow(h,6),l=s.pow(2,52),u=2*l,x=255;function m(t,e,n){var o=[],x=v(f((e=1==e?{entropy:!0}:e||{}).entropy?[t,y(i)]:null==t?function(){try{var t;return a&&(t=a.randomBytes)?t=t(h):(t=new Uint8Array(h),(r.crypto||r.msCrypto).getRandomValues(t)),y(t)}catch(t){var e=r.navigator,n=e&&e.plugins;return[+new Date,r,n,r.screen,y(i)]}}():t,3),o),m=new p(o),w=function(){for(var t=m.g(6),e=d,n=0;t<l;)t=(t+n)*h,e*=h,n=m.g(1);for(;t>=u;)t/=2,e/=2,n>>>=1;return(t+n)/e};return w.int32=function(){return 0|m.g(4)},w.quick=function(){return m.g(4)/4294967296},w.double=w,v(y(m.S),i),(e.pass||n||function(t,e,n,o){return o&&(o.S&&g(o,m),t.state=function(){return g(m,{})}),n?(s[c]=t,e):t})(w,x,"global"in e?e.global:this==s,e.state)}function p(t){var e,n=t.length,o=this,i=0,s=o.i=o.j=0,a=o.S=[];for(n||(t=[n++]);i<h;)a[i]=i++;for(i=0;i<h;i++)a[i]=a[s=x&s+t[i%n]+(e=a[i])],a[s]=e;(o.g=function(t){for(var e,n=0,i=o.i,s=o.j,a=o.S;t--;)e=a[i=x&i+1],n=n*h+a[x&(a[i]=a[s=x&s+e])+(a[s]=e)];return o.i=i,o.j=s,n})(h)}function g(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function f(t,e){var n,o=[],i=typeof t;if(e&&"object"==i)for(n in t)try{o.push(f(t[n],e-1))}catch(t){}return o.length?o:"string"==i?t:t+"\0"}function v(t,e){for(var n,o=t+"",i=0;i<o.length;)e[x&i]=x&(n^=19*e[x&i])+o.charCodeAt(i++);return y(e)}function y(t){return String.fromCharCode.apply(0,t)}if(s["seed"+c]=m,v(s.random(),i),t.exports){t.exports=m;try{a=n(234)}catch(t){}}else void 0===(o=function(){return m}.call(e,n,e,t))||(t.exports=o)}([],Math)},833:function(t,e,n){var o;!function(t,i){function s(t){var e=this;e.next=function(){var t,n,o=e.w,i=e.X,s=e.i;return e.w=o=o+1640531527|0,n=i[s+34&127],t=i[s=s+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=i[s]=n^t,e.i=s,n+(o^o>>>16)|0},function(t,e){var n,o,i,s,a,r=[],h=128;for(e===(0|e)?(o=e,e=null):(e+="\0",o=0,h=Math.max(h,e.length)),i=0,s=-32;s<h;++s)e&&(o^=e.charCodeAt((s+32)%e.length)),0===s&&(a=o),o^=o<<10,o^=o>>>15,o^=o<<4,o^=o>>>13,s>=0&&(a=a+1640531527|0,i=0==(n=r[127&s]^=o+a)?i+1:0);for(i>=128&&(r[127&(e&&e.length||0)]=-1),i=127,s=512;s>0;--s)o=r[i+34&127],n=r[i=i+1&127],o^=o<<13,n^=n<<17,o^=o>>>15,n^=n>>>12,r[i]=o^n;t.w=a,t.X=r,t.i=i}(e,t)}function a(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function r(t,e){null==t&&(t=+new Date);var n=new s(t),o=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===t);return t},i.int32=n.next,i.quick=i,o&&(o.X&&a(o,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=r:n.amdD&&n.amdO?void 0===(o=function(){return r}.call(e,n,e,i))||(i.exports=o):this.xor4096=r}(0,t=n.nmd(t),n.amdD)},848:(t,e,n)=>{"use strict";t.exports=n(20)},993:t=>{"use strict";t.exports=e}},o={};function i(t){var e=o[t];if(void 0!==e)return e.exports;var s=o[t]={id:t,loaded:!1,exports:{}};return n[t].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}i.amdD=function(){throw new Error("define cannot be used indirect")},i.amdO={},i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.nmd=t=>(t.paths=[],t.children||(t.children=[]),t);var s={};return(()=>{"use strict";i.d(s,{default:()=>c});var t=i(442),e=i(993),n=i.n(e),o=i(391),a=i.n(o),r=i(848);class h extends t.Component{constructor(t){super(t),this.state={canvasCreated:!1,hoverIndex:-1,segmentColors:[]},t.segmentationJsonUrl&&fetch(t.segmentationJsonUrl).then(t=>t.json()).then(t=>{t.body&&t.body.predictions&&t.body.predictions[0]&&t.body.predictions[0].vals&&t.body.predictions[0].vals.length>0&&(this.setState({isSegmented:!1}),this.renderSegmentation(t.body.predictions[0].vals))})}componentDidMount(){const t=this.canvas.getContext("2d"),e=new Image;e.src=this.props.options.base64Image?"data:image/png;base64,"+this.props.image:this.props.image,e.onload=()=>{this.canvas.width=e.width,this.canvas.height=e.height,t.drawImage(e,0,0),this.renderBoxes();const n=this.state.pixelSegmentation&&this.state.pixelSegmentation.length>0&&!this.state.isSegmented,o=this.props.pixelSegmentation&&this.props.pixelSegmentation.length>0&&!this.state.isSegmented,i=this.props.segmentationMasks&&this.props.segmentationMasks.length>0&&!this.state.isSegmented;n&&this.renderSegmentation(this.state.pixelSegmentation),o&&this.renderSegmentation(this.props.pixelSegmentation),i&&this.renderSegmentationMasks(),this.canvas.onmousemove=t=>{const e=this.canvas.getBoundingClientRect(),n=this.canvas.width/e.width,o=this.canvas.height/e.height,i=(t.clientX-e.left)*n,s=(t.clientY-e.top)*o,a={index:-1,dimensions:null};this.props.boxes&&this.props.boxes.length>0?this.props.boxes.forEach((t,e)=>{if(!t||void 0===t)return null;const n=t.coord?t.coord:t;let[o,r,h,c]=[0,0,0,0];void 0!==n.xmin&&void 0!==n.xmax&&void 0!==n.ymin&&void 0!==n.ymax?[o,r,h,c]=[Math.min(n.xmin,n.xmax),Math.min(n.ymin,n.ymax),Math.max(n.xmin,n.xmax)-Math.min(n.xmin,n.xmax),Math.max(n.ymin,n.ymax)-Math.min(n.ymin,n.ymax)]:[o,r,h,c]=n,i>=o&&i<=o+h&&s>=r&&s<=r+c&&(!a.dimensions||o>=a.dimensions[0]&&o<=a.dimensions[0]+a.dimensions[2]&&r>=a.dimensions[1]&&r<=a.dimensions[1]+a.dimensions[3])&&(a.index=e,a.dimensions=t)}):this.state.pixelSegmentation&&this.state.pixelSegmentation.length>0&&(a.index=this.state.pixelSegmentation[i+this.canvas.width*s]),this.props.onSelected(a.index),this.setState({hoverIndex:a.index})},this.canvas.onmouseout=()=>{this.props.onSelected(-1),this.setState({hoverIndex:-1})}}}componentWillReceiveProps(t){const e=this.canvas.getContext("2d");e.clearRect(0,0,this.canvas.width,this.canvas.height),this.segCanvas&&this.segCanvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height);const n=new Image;return n.src=t.options.base64Image?"data:image/png;base64,"+this.props.image:t.image,n.onload=()=>{this.canvas.width!==n.width&&this.canvas.height!==n.height&&(this.canvas.width=n.width,this.canvas.height=n.height,e.drawImage(n,0,0),this.renderBoxes(t.boxes))},e.drawImage(n,0,0),this.renderBoxes(t.boxes),this.setState({hoverIndex:t.selectedIndex}),t.pixelSegmentation&&t.pixelSegmentation.length>0&&(this.setState({isSegmented:!1}),this.renderSegmentation(t.pixelSegmentation)),!0}componentDidUpdate(){this.renderBoxes()}segmentColor(t){let e,n,o,i=this.state.segmentColors;if(i[t]&&3===i[t].length)return i[t];if(this.props.segmentationColors&&this.props.segmentationColors[t]){const i=this.props.segmentationColors[t],s=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(i);e=parseInt(s[1],16),n=parseInt(s[2],16),o=parseInt(s[3],16)}else{const i=a()(t);e=Math.floor(255*i()),n=Math.floor(255*i()),o=Math.floor(255*i())}return i[t]=[e,n,o],this.setState({segmentColors:i}),[e,n,o]}renderBox(t,e){if(!t||void 0===t)return null;let n=this.props.options.colors.normal;this.state.hoverIndex>=0&&(n=this.props.options.colors.unselected),e===this.state.hoverIndex&&(n=this.props.options.colors.selected);let o=2;this.canvas.width>600&&(o=3),this.canvas.width>1e3&&(o=5),this.props.drawBox(this.canvas,t,n,o),t.label&&this.props.drawLabel(this.canvas,t)}renderBoxes(t){void 0===t&&(t=this.props.boxes),null===t&&(t=[]),t.map((t,e)=>({box:t,index:e,selected:e===this.state.hoverIndex})).sort(t=>t.selected?1:-1).forEach(t=>this.renderBox(t.box,t.index))}renderSegmentation(t){let e=null,n=null;if(this.props.separateSegmentation&&this.segCanvas){this.segCanvas.width=this.canvas.width,this.segCanvas.height=this.canvas.height,e=this.segCanvas.getContext("2d"),n=e.getImageData(0,0,this.segCanvas.width,this.segCanvas.height);let a=n.data;for(var o=0,i=0,s=a.length;o<s;o+=4,i+=1){const e=t[i],n=this.segmentColor(e);a[o]=n[0],a[o+1]=n[1],a[o+2]=n[2],a[o+3]=255}}else{e=this.canvas.getContext("2d"),n=e.getImageData(0,0,this.canvas.width,this.canvas.height);let a=n.data;for(o=0,i=0,s=a.length;o<s;o+=4,i+=1){const e=t[i],n=this.segmentColor(e);a[o]=Math.round((a[o]+n[0])/2),a[o+1]=Math.round((a[o+1]+n[1])/2),a[o+2]=Math.round((a[o+2]+n[2])/2),a[o+3]=200}}e.putImageData(n,0,0),this.setState({isSegmented:!0})}renderSegmentationMasks(){const{boxes:t,segmentationMasks:e,segmentationTransparency:n}=this.props;this.segCanvas.width=this.canvas.width,this.segCanvas.height=this.canvas.height;const o=this.segCanvas.getContext("2d");e.forEach((e,i)=>{const s=this.segmentColor(t[i].label?t[i].label:i),a=o.getImageData(parseInt(t[i].xmin,10),parseInt(t[i].ymin,10),e.width,e.height);for(let t=0,o=0;t<a.data.length;o++,t+=4)e.data[o]>0&&(a.data[t]=s[0],a.data[t+1]=s[1],a.data[t+2]=s[2],a.data[t+3]=n);o.putImageData(a,parseInt(t[i].xmin,10),parseInt(t[i].ymin,10),0,0,e.width,e.height)}),this.setState({isSegmented:!0})}render(){return(0,r.jsxs)("div",{className:this.props.className,children:[(0,r.jsx)("canvas",{className:"boundingBoxCanvas",style:this.props.options.style,ref:t=>{this.canvas=t}}),this.props.separateSegmentation?(0,r.jsx)("canvas",{className:"boundingSegmentationCanvas",style:this.props.options.styleSegmentation,ref:t=>{this.segCanvas=t}}):null]})}}h.propTypes={image:n().string,boxes:n().oneOfType([n().arrayOf(n().array),n().arrayOf(n().object)]),separateSegmentation:n().bool,segmentationJsonUrl:n().string,segmentationColors:n().array,segmentationMasks:n().array,segmentationTransparency:n().number,selectedIndex:n().number,drawBox:n().func,drawLabel:n().func,onSelected:n().func,options:n().shape({colors:n().shape({normal:n().string,selected:n().string,unselected:n().string}),style:n().object,styleSegmentation:n().object,base64Image:n().bool})},h.defaultProps={boxes:[],separateSegmentation:!1,segmentationTransparency:190,onSelected(){},drawBox(t,e,n,o){if(!e||void 0===e)return null;const i=t.getContext("2d"),s=e.coord?e.coord:e;let[a,r,h,c]=[0,0,0,0];void 0!==s.xmin&&void 0!==s.xmax&&void 0!==s.ymin&&void 0!==s.ymax?[a,r,h,c]=[Math.min(s.xmin,s.xmax),Math.min(s.ymin,s.ymax),Math.max(s.xmin,s.xmax)-Math.min(s.xmin,s.xmax),Math.max(s.ymin,s.ymax)-Math.min(s.ymin,s.ymax)]:[a,r,h,c]=s,a<o/2&&(a=o/2),r<o/2&&(r=o/2),a+h>t.width&&(h=t.width-o-a),r+c>t.height&&(c=t.height-o-r);const d=h/10,l=9*d;i.strokeStyle=n,i.lineWidth=o,i.beginPath(),i.moveTo(a+d,r),i.lineTo(a,r),i.lineTo(a,r+c),i.lineTo(a+d,r+c),i.stroke(),i.beginPath(),i.moveTo(a+l,r),i.lineTo(a+h,r),i.lineTo(a+h,r+c),i.lineTo(a+l,r+c),i.stroke()},drawLabel(t,e){if(!e||void 0===e)return null;const n=t.getContext("2d"),o=e.coord?e.coord:e;let[i,s,a,r]=[0,0,0,0];void 0!==o.xmin&&void 0!==o.xmax&&void 0!==o.ymin&&void 0!==o.ymax?[i,s,a,r]=[Math.min(o.xmin,o.xmax),Math.min(o.ymin,o.ymax),Math.max(o.xmin,o.xmax)-Math.min(o.xmin,o.xmax),Math.max(o.ymin,o.ymax)-Math.min(o.ymin,o.ymax)]:[i,s,a,r]=o,n.font="60px Arial",n.fillStyle="rgba(225,0,0,1)",n.fillText(e.label,i,s+r)},options:{colors:{normal:"rgba(255,225,255,1)",selected:"rgba(0,225,204,1)",unselected:"rgba(100,100,100,1)"},style:{maxWidth:"100%",maxHeight:"90vh"},styleSegmentation:{maxWidth:"100%",maxHeight:"90vh",pointerEvents:"none"},base64Image:!1}};const c=h})(),s.default})());
//# sourceMappingURL=react-bounding-box.js.map